version: '3.8'

services:
  db:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
    ports:
      - "3306:3306"
    command: >
      sh -c "sudo dnf install git -y &&
             git clone https://github.com/RedAzrael/paco-database.git /tmp/db-script &&
             sudo mysql -u root -prootpass < /tmp/db-script/init.sql"


  backend:
    image: python:3.9
    depends_on:
      - db
    environment:
      DB_HOST: db
      DB_PORT: 3306
    ports:
      - "3001:3001"
    command: >
      sh -c "apt-get update && apt-get install -y git &&
             git clone https://github.com/RedAzrael/paco-backend.git /app &&
             cd /app &&
             pip install -r requirements.txt &&
             python main.py"

  frontend:
    image: node:18
    depends_on:
      - backend
    environment:
      REACT_APP_API_URL: http://backend:3001
    ports:
      - "3000:3000"
    command: >
      sh -c "apt-get update && apt-get install -y git &&
             git clone https://github.com/RedAzrael/paco-frontend.git /app &&
             cd /app &&
             npm install &&
             npm start"

